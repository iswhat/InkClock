# 家用网络智能墨水屏万年历 - 产品需求文档

## 1. 引言

### 1.1 文档目的

本需求文档详细描述了家用网络智能墨水屏万年历的功能需求、非功能需求、技术规格和设计约束，旨在为产品开发、测试和验收提供明确的依据。

### 1.2 术语定义

| 术语 | 解释 |
|------|------|
| ESP32-S3 | 乐鑫公司推出的一款低功耗WiFi+蓝牙双模微控制器 |
| 墨水屏 | 一种低功耗、高清晰度的电子纸显示技术 |
| NTP | 网络时间协议，用于同步设备时间 |
| API | 应用程序编程接口，用于不同系统间的数据交互 |
| OTA | 空中升级，通过网络远程更新设备固件 |
| IPv6 | 互联网协议第6版，用于标识和定位网络设备 |
| MQTT | 消息队列遥测传输，一种轻量级的消息传输协议 |

## 2. 产品概述

### 2.1 产品定位

家用网络智能墨水屏万年历是一款面向家庭用户的智能设备，采用墨水屏显示，具有低功耗、高清晰度、可远程配置等特点。设备能够自动获取时间、天气、农历、节假日等信息，并支持模块化扩展和二次开发。

### 2.2 产品特点

- **低功耗设计**：采用墨水屏显示，功耗极低，可使用锂电池供电，续航时间长
- **高清晰度显示**：支持多种尺寸的墨水屏，显示清晰，视角广
- **自动同步数据**：自动获取时间、天气、农历等信息，无需手动设置
- **地理位置自动识别**：通过网络IP自动检测地理位置，也可手动配置
- **模块化设计**：支持插件扩展，可方便添加新功能
- **远程配置管理**：通过Web页面进行设备配置和管理
- **多种网络支持**：支持WiFi连接，支持IPv6
- **蓝牙配置**：支持首次WiFi配置
- **传感器支持**：支持温湿度传感器数据采集和显示

### 2.3 应用场景

- 家庭客厅、卧室、书房等场所的时间和天气显示
- 办公室的日程和天气提醒
- 老人和儿童的时间和日期参考
- 智能家居系统的信息显示终端
- 二次开发和DIY爱好者的学习和实践平台

## 3. 功能需求

### 3.1 核心功能

#### 3.1.1 时间显示功能

| 功能点 | 描述 | 优先级 |
|--------|------|--------|
| 实时时间显示 | 显示当前时间，包括时、分、秒 | 高 |
| 日期显示 | 显示当前日期，包括年、月、日、星期 | 高 |
| 农历显示 | 显示农历日期、节气、干支纪年 | 高 |
| 时区自动调整 | 自动处理时区和夏令时 | 中 |
| NTP时间同步 | 通过NTP服务器自动同步时间 | 高 |
| 备用NTP服务器 | 支持多个NTP服务器，提高可靠性 | 中 |

#### 3.1.2 天气显示功能

| 功能点 | 描述 | 优先级 |
|--------|------|--------|
| 当前天气显示 | 显示当前天气状况、温度、湿度、风力等信息 | 高 |
| 天气预报显示 | 显示未来5天的天气预报 | 高 |
| 天气图标显示 | 使用直观的图标表示天气状况 | 中 |
| 主备天气API | 支持主天气API和备用天气API，提高可靠性 | 中 |
| 天气更新频率设置 | 可设置天气数据的更新频率 | 中 |

#### 3.1.3 地理位置管理功能

| 功能点 | 描述 | 优先级 |
|--------|------|--------|
| 自动地理位置检测 | 通过网络IP自动检测地理位置 | 高 |
| 手动地理位置配置 | 支持手动输入城市ID、城市名称、纬度、经度 | 高 |
| 地理位置信息存储 | 保存地理位置配置，断电后不丢失 | 高 |
| 地理位置自动更新 | 定期自动更新地理位置信息 | 中 |

#### 3.1.4 传感器数据显示功能

| 功能点 | 描述 | 优先级 |
|--------|------|--------|
| 温湿度数据采集 | 支持DHT11、DHT22、DHT12、SHT30、SHT21、SHT40、AM2302、HDC1080、BME280、BME680、HTU21D、SI7021等多种温湿度传感器 | 中 |
| 人体感应数据采集 | 支持HC-SR501、HC-SR505、RE200B、LD2410、BH1750等人体感应传感器 | 中 |
| 光照数据采集 | 支持BH1750、VEML6075、TSL2561、GY30、SI1145等光照传感器 | 中 |
| 气体数据采集 | 支持MQ2、MQ5、MQ7、MQ8、MQ135、TGS2600等气体传感器（用于燃气泄露、一氧化碳浓度检测） | 高 |
| 火焰数据采集 | 支持IR、UV、YG1006、MQ2、TGS2600等火焰传感器（用于火灾检测） | 高 |
| 传感器数据显示 | 在屏幕上显示当前传感器数据 | 中 |
| 传感器数据更新频率 | 可设置传感器数据的更新频率 | 低 |
| 传感器开关控制 | 可在设备设置中对各个传感器进行开关控制 | 中 |
| 传感器阈值设置 | 可调整传感器的报警阈值，调整灵敏度 | 中 |

### 3.2 扩展功能

#### 3.2.1 插件扩展功能

| 功能点 | 描述 | 优先级 |
|--------|------|--------|
| 插件管理界面 | 提供Web页面进行插件管理 | 中 |
| 插件安装和卸载 | 支持插件的安装和卸载 | 中 |
| 插件启用和禁用 | 支持插件的启用和禁用 | 中 |
| 插件配置 | 支持插件的参数配置 | 中 |
| 插件更新 | 支持插件的在线更新 | 低 |

#### 3.2.2 Web配置功能

| 功能点 | 描述 | 优先级 |
|--------|------|--------|
| 设备状态显示 | 显示设备的基本信息和状态 | 高 |
| WiFi配置 | 支持WiFi连接配置 | 高 |
| 时间配置 | 支持时区和夏令时配置 | 中 |
| 天气配置 | 支持天气API密钥和更新频率配置 | 中 |
| 地理位置配置 | 支持地理位置的自动检测和手动配置 | 高 |
| 显示配置 | 支持显示刷新频率和显示模式配置 | 中 |
| 系统配置 | 支持系统级别的配置和管理 | 中 |

#### 3.2.3 消息推送功能

| 功能点 | 描述 | 优先级 |
|--------|------|--------|
| 消息接收 | 支持接收来自云端的消息推送 | 中 |
| 消息显示 | 在屏幕上显示推送的消息 | 中 |
| 消息存储 | 支持消息的存储和历史记录查看 | 低 |

#### 3.2.4 股票数据显示功能

| 功能点 | 描述 | 优先级 |
|--------|------|--------|
| 股票数据获取 | 支持获取股票实时数据 | 低 |
| 股票数据显示 | 在屏幕上显示股票数据 | 低 |
| 股票列表配置 | 支持配置关注的股票列表 | 低 |

### 3.3 系统功能

#### 3.3.1 电源管理功能

| 功能点 | 描述 | 优先级 |
|--------|------|--------|
| 低功耗模式 | 支持设备进入低功耗模式 | 高 |
| 电源状态监测 | 监测设备的电源状态 | 中 |
| 电池电量显示 | 显示电池电量（如果使用锂电池） | 中 |
| 充电状态显示 | 显示充电状态（如果支持充电） | 低 |

#### 3.3.2 固件更新功能

| 功能点 | 描述 | 优先级 |
|--------|------|--------|
| OTA固件更新 | 支持通过网络远程更新固件 | 中 |
| 固件版本检查 | 自动检查固件更新 | 低 |
| 固件更新状态显示 | 显示固件更新的进度和状态 | 中 |

#### 3.3.3 错误处理功能

| 功能点 | 描述 | 优先级 |
|--------|------|--------|
| 错误检测 | 检测系统运行中的错误 | 高 |
| 错误日志记录 | 记录错误信息 | 中 |
| 错误恢复机制 | 自动尝试恢复错误状态 | 高 |
| 安全模式 | 错误严重时进入安全模式 | 高 |

## 4. 非功能需求

### 4.1 性能需求

| 需求点 | 描述 | 目标值 |
|--------|------|--------|
| 启动时间 | 设备从启动到显示正常内容的时间 | < 10秒 |
| 数据更新时间 | 从请求数据到显示更新的时间 | < 5秒 |
| 响应时间 | Web页面的响应时间 | < 2秒 |
| 电池续航 | 使用锂电池供电时的续航时间 | > 30天 |
| 显示刷新频率 | 可配置的显示刷新频率 | 1分钟 - 1小时 |

### 4.2 可靠性需求

| 需求点 | 描述 | 目标值 |
|--------|------|--------|
| 系统稳定性 | 系统连续运行时间 | > 365天 |
| 数据可靠性 | 数据更新成功率 | > 99% |
| 错误恢复能力 | 系统错误自动恢复成功率 | > 95% |
| 备用API支持 | 主API失效时，备用API切换成功率 | > 99% |

### 4.3 可用性需求

| 需求点 | 描述 | 目标值 |
|--------|------|--------|
| 易用性 | 首次配置步骤数 | < 5步 |
| 可维护性 | 系统可维护性指数 | > 8/10 |
| 可扩展性 | 支持插件数量 | 无限制 |
| 兼容性 | 支持的墨水屏尺寸 | 1.54-7.5英寸 |

### 4.4 安全性需求

| 需求点 | 描述 | 目标值 |
|--------|------|--------|
| 网络安全 | WiFi密码加密存储 | AES-256 |
| API安全 | API请求认证机制 | Token认证 |
| 固件安全 | 固件签名验证 | RSA-2048 |
| 数据安全 | 敏感数据加密传输 | TLS 1.3 |

## 5. 技术规格

### 5.1 硬件规格

| 组件 | 规格 | 备注 |
|------|------|------|
| 主控芯片 | ESP32-S3 | 双核32位处理器，主频240MHz |
| 内存 | 512KB SRAM + 8MB PSRAM | 可选 |
| 存储 | 16MB Flash | 用于存储固件和数据 |
| 显示屏幕 | 1.54/2.13/2.66/2.7/2.9/3.12/4.2/4.37/5.4/5.83/6.0/7.5英寸墨水屏 | 支持多种尺寸 |
| 通信接口 | WiFi 802.11 b/g/n, Bluetooth 5.0 | 双模通信 |
| 传感器接口 | I2C, SPI, UART | 支持多种传感器 |
| 电源输入 | 5V DC或3.7V锂电池 | 支持充电 |
| 工作温度 | -20℃ ~ 60℃ | 宽温设计 |
| 工作湿度 | 0% ~ 90% RH | 无凝结 |

### 5.2 软件规格

| 项目 | 规格 | 备注 |
|------|------|------|
| 操作系统 | FreeRTOS | 实时操作系统 |
| 开发框架 | Arduino ESP32 | 便于开发和二次开发 |
| 编程语言 | C++ | 支持C++11及以上标准 |
| Web服务器 | ESPAsyncWebServer | 异步Web服务器 |
| JSON库 | ArduinoJson | 用于JSON数据解析和生成 |
| 网络库 | WiFiClientSecure, HTTPClient | 用于网络通信 |
| 存储库 | LittleFS | 用于文件存储 |
| 加密库 | mbedtls | 用于数据加密和安全通信 |

### 5.3 网络规格

| 项目 | 规格 | 备注 |
|------|------|------|
| WiFi标准 | 802.11 b/g/n | 2.4GHz频段 |
| 网络协议 | IPv4/IPv6 | 双栈支持 |
| API请求 | HTTPS/TLS 1.3 | 安全通信 |
| NTP服务器 | 支持多个NTP服务器 | 提高可靠性 |
| MQTT支持 | 可选 | 用于消息推送 |

## 6. 设计约束

### 6.1 硬件约束

- 墨水屏的刷新速度较慢，需要优化显示刷新策略
- 墨水屏的颜色有限，通常为黑白或黑白红三色
- ESP32-S3的资源有限，需要优化内存和CPU使用
- 电源供应有限，需要优化功耗

### 6.2 软件约束

- 必须使用Arduino ESP32框架，便于二次开发
- 必须支持C++11及以上标准
- 必须遵循模块化设计原则
- 必须支持固件OTA更新
- 必须使用安全的通信协议

### 6.3 接口约束

- 必须提供统一的API管理接口
- 必须提供Web配置页面
- 必须支持插件扩展接口
- 必须支持传感器驱动接口

## 7. 验收标准

### 7.1 功能验收

| 功能点 | 验收标准 |
|--------|----------|
| 时间显示 | 能够正确显示当前时间，自动同步NTP时间 |
| 天气显示 | 能够正确显示当前天气和5天天气预报 |
| 农历显示 | 能够正确显示农历日期、节气、干支纪年 |
| 地理位置管理 | 能够自动检测地理位置，也可手动配置 |
| 传感器数据显示 | 能够正确显示温湿度数据 |
| Web配置 | 能够通过Web页面进行设备配置和管理 |
| 固件更新 | 能够通过OTA更新固件 |
| 错误处理 | 系统错误时能够自动恢复或进入安全模式 |

### 7.2 性能验收

| 性能指标 | 验收标准 |
|----------|----------|
| 启动时间 | 设备从启动到显示正常内容的时间 < 10秒 |
| 数据更新时间 | 从请求数据到显示更新的时间 < 5秒 |
| 响应时间 | Web页面的响应时间 < 2秒 |
| 电池续航 | 使用锂电池供电时的续航时间 > 30天 |
| 系统稳定性 | 系统连续运行时间 > 30天 |

### 7.3 可靠性验收

| 可靠性指标 | 验收标准 |
|------------|----------|
| 数据更新成功率 | > 99% |
| 错误恢复能力 | 系统错误自动恢复成功率 > 95% |
| 备用API支持 | 主API失效时，备用API切换成功率 > 99% |

## 8. 风险评估

| 风险点 | 可能性 | 影响程度 | 缓解措施 |
|--------|--------|----------|----------|
| 网络连接不稳定 | 中 | 高 | 增加网络重连机制，优化网络请求策略 |
| API请求失败 | 中 | 中 | 实现备用API机制，增加请求重试次数 |
| 固件更新失败 | 低 | 高 | 实现固件备份和恢复机制，增加更新验证 |
| 墨水屏显示异常 | 低 | 中 | 优化显示驱动，增加显示自检机制 |
| 电源供应不稳定 | 低 | 高 | 增加电源管理和保护机制 |
| 内存不足 | 低 | 高 | 优化内存使用，增加内存监控和管理 |

## 9. 附录

### 9.1 参考文档

- ESP32-S3 Datasheet
- Arduino ESP32 Documentation
- Eink Display Driver Documentation
- NTP Protocol Specification
- HTTP/HTTPS Protocol Specification
- IPv6 Protocol Specification

### 9.2 版本历史

| 版本 | 日期 | 作者 | 描述 |
|------|------|------|------|
| v1.0 | 2025-12-01 | iswhat | 初始版本 |
| v1.1 | 2025-12-26 | iswhat | 新增地理位置自动识别功能，优化API管理模块 |

### 9.3 联系方式

- 项目主页：https://github.com/iswhat/InkClock
- 电子邮件：contact@iswhat.com
- 社区交流：https://discord.gg/xxxxxx
