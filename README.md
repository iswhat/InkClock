# 家用网络智能墨水屏万年历

## 项目简介

家用网络智能墨水屏万年历是一款基于ESP32的智能设备，采用墨水屏显示，具有低功耗、高清晰度、可远程配置等特点。设备能够自动获取时间、天气、农历、节假日等信息，并支持模块化扩展和二次开发。

## 主要功能

1. **实时时间显示**：支持NTP时间同步，自动处理时区和夏令时
2. **天气信息展示**：显示当前天气、温度、湿度、风力等信息，支持5天天气预报
3. **农历与节假日**：显示农历日期、节气、节假日信息
4. **地理位置自动识别**：通过网络IP自动检测地理位置，也可手动配置
5. **传感器数据监测**：支持温湿度传感器数据采集和显示
6. **模块化设计**：支持插件扩展，可方便添加新功能
7. **远程配置**：通过Web页面进行设备配置和管理
8. **低功耗设计**：采用墨水屏和智能电源管理，续航时间长
9. **多种网络支持**：支持WiFi连接，支持IPv6
10. **蓝牙配置**：支持首次WiFi配置
11. **远程留言推送**：支持文字、图片、音频（需外置存储）、视频（需外置存储）等留言推送
12. **股票数据展示**：显示关注股票的实时行情和大盘曲线
13. **插件功能扩展**：支持古诗、英语单词等插件，可根据需要扩展更多功能

## 软件架构

系统采用模块化设计，主要包含以下模块：

1. **核心模块**：
   - WiFiManager：WiFi连接管理
   - TimeManager：时间同步和管理
   - APIManager：统一API请求管理
   - GeoManager：地理位置管理

2. **功能模块**：
   - WeatherManager：天气数据获取和管理
   - LunarManager：农历和节假日管理
   - SensorManager：传感器数据采集
   - DisplayManager：显示管理

3. **扩展模块**：
   - PluginManager：插件管理
   - WebServerManager：Web服务器
   - MessageManager：消息管理
   - StockManager：股票数据管理

## 快速开始

### 硬件连接

1. 将墨水屏连接到ESP32开发板
2. 连接温湿度传感器（可选）
3. 连接电源

### 软件烧录

1. 安装PlatformIO IDE
2. 克隆项目代码
3. 在PlatformIO中打开项目
4. 选择对应的开发板型号
5. 修改`config.h`中的基本配置
6. 编译并上传固件

### 首次配置

1. 设备启动后，会创建一个名为"InkClock-XXXX"的WiFi热点
2. 用手机或电脑连接该热点
3. 在浏览器中访问192.168.4.1
4. 配置WiFi信息和基本设置
5. 保存配置后，设备会自动连接到指定的WiFi网络

### 正常使用

设备连接WiFi后，会自动获取时间、天气等信息，并在墨水屏上显示。您可以通过以下方式管理设备：

1. **Web配置页面**：在浏览器中访问设备的IP地址
2. **配置地理位置**：在Web页面中开启自动检测或手动输入地理位置信息
3. **更新频率设置**：调整时间、天气等信息的更新频率
4. **插件管理**：添加、启用、禁用插件

## 二次开发

### 开发环境搭建

1. 安装PlatformIO IDE
2. 克隆项目代码
3. 在PlatformIO中打开项目
4. 安装所需的依赖库

### 模块扩展

1. **添加新插件**：
   - 在`plugin_manager.h`中定义插件类型
   - 实现插件类，继承自`Plugin`基类
   - 在`plugin_manager.cpp`中注册插件

2. **添加新传感器**：
   - 在`sensor_driver.h`中定义传感器驱动接口
   - 实现传感器驱动类
   - 在`sensor_manager.cpp`中注册传感器

3. **添加新显示驱动**：
   - 在`display_driver.h`中定义显示驱动接口
   - 实现显示驱动类
   - 在`display_manager.cpp`中注册显示驱动

### API调用

系统提供了统一的API管理接口，可用于获取外部数据：

```cpp
// 示例：获取天气数据
String url = "https://api.weather.com/weather";
ApiResponse response = apiManager.get(url, API_TYPE_WEATHER, 3600000);
```

## 配置说明

主要配置文件为`config.h`，包含以下主要配置项：

| 配置项 | 说明 | 默认值 |
|--------|------|--------|
| AUTO_DETECT_LOCATION | 是否自动检测地理位置 | true |
| GEO_CITY_ID | 默认城市ID | "your_city_id" |
| WEATHER_API_KEY | 天气API密钥 | "your_weather_api_key" |
| WEATHER_UPDATE_INTERVAL | 天气更新间隔（毫秒） | 3600000 |
| DISPLAY_UPDATE_INTERVAL | 显示更新间隔（毫秒） | 300000 |
| TIME_ZONE_OFFSET | 时区偏移（小时） | 8 |

## 常见问题

1. **设备无法连接WiFi**：
   - 检查WiFi密码是否正确
   - 检查WiFi信号强度
   - 尝试重置设备

2. **时间显示不准确**：
   - 检查时区设置是否正确
   - 确保设备能够连接到NTP服务器

3. **天气信息不更新**：
   - 检查天气API密钥是否正确
   - 确保设备能够访问互联网
   - 检查城市ID是否正确

4. **显示异常**：
   - 检查墨水屏连接是否正确
   - 尝试重启设备

## 兼容元器件列表

### 主控芯片
- ESP32-S3
- ESP32-C3
- ESP32-C6

### 显示屏幕
- 1.54/2.13/2.66/2.7/2.9/3.12/4.2/4.37/5.4/5.83/6.0/7.5英寸墨水屏

### 传感器
- 温湿度传感器：DHT22/SHT30
- 人体感应传感器：HC-SR501/PIR
- 光照传感器：BH1750
- 气体传感器：MQ-2/MQ-135（用于燃气泄露、一氧化碳浓度检测）
- 火焰传感器：IR Flame Sensor（用于火灾检测）

### 存储设备
- MicroSD卡（用于音频、视频存储）

### 电源模块
- 软包聚合物电池（3.7V）

## 许可证

本项目采用MIT许可证，详见LICENSE文件。

## 贡献

欢迎提交Issue和Pull Request，共同完善项目。

## 作者信息

- 开发者：iswhat
- GitHub：https://github.com/iswhat/InkClock

## 版本历史

### v1.1 (2025-12-26)
- 新增地理位置自动识别功能
- 优化API管理模块
- 修复部分bug

### v1.0 (2025-12-01)
- 初始版本发布
- 支持基本的时间、天气、农历显示
- 支持Web配置和插件扩展
