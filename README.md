# 家用网络智能墨水屏万年历

## 项目简介

家用网络智能墨水屏万年历是一款支持多种低功耗WiFi+蓝牙双模微控制器的智能设备系统，包含设备端和服务端两大部分。设备端采用墨水屏显示，具有低功耗、高清晰度、可远程配置等特点；服务端提供消息中转、插件管理和固件管理等功能。系统采用三层架构设计，能够自动获取时间、天气、农历、节假日等信息，并支持模块化扩展和二次开发。

## 系统架构

### 整体架构

```
┌─────────────────────────────────────────────────────────────────────────┐
│                            系统架构                                      │
├────────────────────────────────┬─────────────────────────────────────────┤
│       设备端 (Device)          │           服务端 (Server)               │
├────────────────────────────────┼─────────────────────────────────────────┤
│  ┌──────────────────────────┐  │  ┌────────────────────────────────────┐ │
│  │      应用层               │  │  │       Web Server                   │ │
│  ├──────────────────────────┤  │  ├────────────────────────────────────┤ │
│  │  时间管理、天气管理       │  │  │  ┌───────────────────────────────┐ │ │
│  │  农历管理、传感器数据管理 │  │  │  │  消息管理系统                │ │ │
│  │  显示管理、插件管理       │  │  │  ├───────────────────────────────┤ │ │
│  │  固件管理                 │  │  │  │  - 消息中转服务              │ │ │
│  ├──────────────────────────┤  │  │  │  - 消息存储与检索            │ │ │
│  │      驱动程序层           │  │  │  └───────────────────────────────┘ │ │
│  ├──────────────────────────┤  │  │  ┌───────────────────────────────┐ │ │
│  │  传感器驱动、显示驱动     │  │  │  │  插件管理系统                │ │ │
│  │  通信驱动、电源驱动       │  │  │  ├───────────────────────────────┤ │ │
│  │  固件管理驱动             │  │  │  │  - 插件上传与安装            │ │ │
│  ├──────────────────────────┤  │  │  │  - 插件版本管理              │ │ │
│  │      底层操作系统         │  │  │  └───────────────────────────────┘ │ │
│  └──────────────────────────┘  │  │  ┌───────────────────────────────┐ │ │
│                                │  │  │  固件管理服务                │ │ │
│                                │  │  ├───────────────────────────────┤ │ │
│                                │  │  │  - 固件版本管理              │ │ │
│                                │  │  │  - 多设备固件推送            │ │ │
│                                │  │  │  - 固件完整性验证            │ │ │
│                                │  │  └───────────────────────────────┘ │ │
│                                │  └────────────────────────────────────┘ │
│                                │  ┌────────────────────────────────────┐ │
│                                │  │       数据库                     │ │
│                                │  └────────────────────────────────────┘ │
└────────────────────────────────┴─────────────────────────────────────────┘
```

### 设备端架构

设备端采用三层架构设计，确保系统的稳定性、可扩展性和低功耗：

#### 1. 底层操作系统（CoreSystem）

底层操作系统是系统的核心，负责管理系统资源、提供基础服务，与硬件直接交互。

##### 核心功能
- **电源管理**：低功耗模式控制、电池电量监测、充电状态管理
- **配置管理**：统一的配置存储和访问API
- **定时器管理**：支持周期性和一次性定时器
- **事件总线**：模块间通信的核心，支持85+事件类型
- **系统安全**：错误处理、安全模式保障

##### 设计特点
- 最小核心运行，最大稳定性
- 与应用层完全解耦
- 支持多种硬件平台
- 低功耗设计，续航时间长

#### 2. 驱动程序层

驱动程序层提供统一的设备抽象接口，支持动态注册和管理传感器、显示设备等硬件。

##### 核心功能
- **传感器驱动**：支持多种温湿度、人体感应、光照、气体、火焰等传感器
- **显示驱动**：支持多种尺寸和类型的墨水屏
- **通信驱动**：WiFi、蓝牙通信驱动
- **电源驱动**：电源管理、电量监测
- **固件管理驱动**：固件更新、完整性验证、签名验证、双分区管理
- **驱动注册中心**：动态管理驱动，支持自动检测和设备发现

##### 设计特点
- 统一的驱动接口，易于扩展
- 支持热插拔和动态加载
- 自动检测和设备发现
- 支持多种硬件平台

#### 3. 应用层

应用层包含各种功能模块，通过事件总线与底层通信，实现具体的业务逻辑。

##### 核心功能
- **时间管理**：NTP时间同步、时间显示
- **天气管理**：天气数据获取和显示
- **农历管理**：农历日期、节气、节假日显示
- **传感器数据管理**：传感器数据采集和显示
- **显示管理**：页面渲染和显示刷新
- **插件管理**：动态加载和卸载插件
- **固件管理**：OTA更新、固件验证、分区管理、回滚机制

##### 设计特点
- 事件驱动编程，模块间低耦合
- 支持动态插件扩展
- 易于开发和维护
- 支持多种应用场景

### 服务端架构

服务端采用Web Server架构，提供消息中转、插件管理和固件管理等服务：

#### 1. Web Server

Web Server是服务端的核心，提供API接口和Web管理界面，支持多种功能模块：

##### 核心组件
- **API接口层**：提供RESTful API接口，支持设备通信、消息管理、固件管理等
- **业务逻辑层**：处理各种业务逻辑，如设备注册、消息转发、固件发布等
- **数据访问层**：与数据库交互，实现数据的存储和检索

##### 设计特点
- 模块化设计，易于扩展
- RESTful API设计，支持跨平台通信
- 支持CORS，便于前端开发
- 完善的错误处理和日志记录

#### 2. 消息管理系统

消息管理系统负责设备间的消息中转和存储，支持多种消息类型：

##### 核心功能
- **消息中转服务**：实现设备与服务器、设备与设备之间的消息转发
- **消息存储与检索**：持久化存储消息，支持按设备、时间等条件检索
- **消息状态管理**：支持消息的发送、接收、已读、删除等状态管理
- **消息过期处理**：自动清理过期消息，优化存储空间

##### 设计特点
- 支持多种消息类型（文本、图片、音频、视频）
- 消息可靠性保障，支持消息重试
- 高效的消息存储和检索机制
- 支持消息优先级管理

#### 3. 插件管理系统

插件管理系统负责插件的上传、安装、版本管理和分发：

##### 核心功能
- **插件上传与安装**：支持插件的上传、解压、验证和安装
- **插件版本管理**：支持插件的版本控制、更新和回滚
- **插件分发服务**：将插件分发给设备端，支持按需下载
- **插件依赖管理**：自动处理插件间的依赖关系

##### 设计特点
- 支持多种插件格式
- 插件安全性验证，防止恶意插件
- 高效的插件分发机制
- 支持插件的在线更新

#### 4. 固件管理服务

固件管理服务负责固件的版本管理、发布和OTA推送：

##### 核心功能
- **固件版本管理**：支持固件的上传、存储、版本控制和删除
- **多设备固件推送**：支持按设备型号、版本等条件推送固件
- **固件完整性验证**：使用SHA-256哈希值验证固件完整性
- **固件签名验证**：验证固件签名，防止恶意固件
- **更新状态监控**：实时监控固件更新状态，支持更新进度查询

##### 设计特点
- 支持多种设备型号
- 支持固件的分批推送
- 完善的更新状态报告和错误处理
- 支持固件的回滚机制

#### 5. 数据库设计

数据库采用关系型数据库设计，存储设备信息、消息、固件版本等数据：

##### 主要表结构
- **devices**：设备信息表，存储设备ID、型号、版本、状态等
- **messages**：消息表，存储消息ID、设备ID、内容、类型、状态等
- **firmware_versions**：固件版本表，存储版本号、设备型号、文件信息、哈希值等
- **plugins**：插件表，存储插件ID、名称、版本、描述等

##### 设计特点
- 规范化设计，避免数据冗余
- 支持高并发访问
- 完善的索引设计，提高查询效率
- 支持数据备份和恢复

## 主要功能

### 设备端功能

1. **实时时间显示**：支持NTP时间同步，自动处理时区和夏令时
2. **天气信息展示**：显示当前天气、温度、湿度、风力等信息，支持5天天气预报
3. **农历与节假日**：显示农历日期、节气、节假日信息
4. **地理位置自动识别**：通过网络IP自动检测地理位置，也可手动配置
5. **传感器数据监测**：支持温湿度、人体感应、光照、气体、火焰等传感器数据采集和显示
6. **模块化设计**：支持插件扩展，可方便添加新功能
7. **远程配置**：通过Web页面进行设备配置和管理
8. **低功耗设计**：采用墨水屏和智能电源管理，续航时间长
9. **多种网络支持**：支持WiFi连接，支持IPv6
10. **蓝牙配置**：支持首次WiFi配置
11. **远程留言推送**：支持文字、图片、音频（需TF卡）、视频（需TF卡）等留言推送
12. **股票数据展示**：显示关注股票的实时行情和大盘曲线
13. **插件功能扩展**：支持古诗、英语单词等插件，可根据需要扩展更多功能
14. **字体管理功能**：支持自定义字体上传和选择
15. **TF卡功能**：用于存储音频、图片、视频等数据
16. **TF卡管理功能**：用于管理TF卡中的内容
17. **本地视频留言**：支持本地录制视频留言（需摄像头和TF卡）
18. **固件管理**：支持OTA远程更新，包含固件完整性验证、签名验证、双分区更新和回滚机制

### 服务端功能

1. **设备管理**：支持设备注册、状态查询、设备信息管理等
2. **消息管理**：
   - 消息中转服务：实现设备与服务器、设备与设备之间的消息转发
   - 消息存储与检索：持久化存储消息，支持按设备、时间等条件检索
   - 消息状态管理：支持消息的发送、接收、已读、删除等状态管理
   - 支持多种消息类型（文本、图片、音频、视频）
3. **插件管理系统**：
   - 插件上传与安装：支持插件的上传、解压、验证和安装
   - 插件版本管理：支持插件的版本控制、更新和回滚
   - 插件分发服务：将插件分发给设备端，支持按需下载
   - 插件依赖管理：自动处理插件间的依赖关系
4. **固件管理服务**：
   - 固件版本管理：支持固件的上传、存储、版本控制和删除
   - 多设备固件推送：支持按设备型号、版本等条件推送固件
   - 固件完整性验证：使用SHA-256哈希值验证固件完整性
   - 固件签名验证：验证固件签名，防止恶意固件
   - 更新状态监控：实时监控固件更新状态，支持更新进度查询
   - 支持多种设备型号和固件版本管理
5. **Web管理界面**：提供直观的Web界面，方便管理设备、消息、插件和固件
6. **API服务**：提供RESTful API接口，支持第三方系统集成
7. **数据统计与分析**：支持设备在线状态、消息发送量、固件更新成功率等数据统计
8. **日志管理**：完善的日志记录，支持日志查询和分析
9. **安全机制**：支持API密钥认证、数据加密传输、固件签名验证等安全措施

## 快速开始

### 设备端快速开始

#### 硬件连接

1. 将墨水屏连接到ESP32开发板
2. 连接传感器（可选）
3. 连接电源

#### 软件烧录

1. 安装PlatformIO IDE
2. 克隆项目代码
3. 在PlatformIO中打开项目
4. 选择对应的开发板型号
5. 修改`src/coresystem/config.h`中的基本配置
6. 编译并上传固件

#### 首次配置

1. 设备启动后，会创建一个名为"InkClock-XXXX"的WiFi热点
2. 用手机或电脑连接该热点
3. 在浏览器中访问192.168.4.1
4. 配置WiFi信息和基本设置
5. 保存配置后，设备会自动连接到指定的WiFi网络

#### 正常使用

设备连接WiFi后，会自动获取时间、天气等信息，并在墨水屏上显示。您可以通过以下方式管理设备：

1. **Web配置页面**：在浏览器中访问设备的IP地址
2. **配置地理位置**：在Web页面中开启自动检测或手动输入地理位置信息
3. **更新频率设置**：调整时间、天气等信息的更新频率
4. **插件管理**：添加、启用、禁用插件
5. **固件更新**：在Web页面中检查并安装最新固件

### 服务端快速开始

#### 环境要求

- PHP 7.4+（支持mysqli扩展）
- MySQL 5.7+ 或 MariaDB 10.3+
- Web服务器（如Apache、Nginx）

#### 部署步骤

1. **数据库初始化**：
   - 创建数据库（如：`inkclock`）
   - 导入数据库初始化脚本：`d:\InkClock\webserver\init_db.sql`
   - 修改`d:\InkClock\webserver\config.php`中的数据库配置

2. **Web服务器配置**：
   - 将`d:\InkClock\webserver`目录部署到Web服务器根目录或子目录
   - 配置Web服务器支持PHP
   - 确保`uploads`目录具有可写权限

3. **配置文件修改**：
   - 编辑`d:\InkClock\webserver\config.php`，修改相关配置项
   - 设置API密钥、文件上传路径、数据库连接信息等

4. **测试部署**：
   - 在浏览器中访问`http://your-server-address/api.php?path=status`
   - 若返回`{"status":"ok"}`，表示部署成功

#### 服务端管理

1. **固件管理**：
   - 通过API或Web界面上传和管理固件版本
   - 支持按设备型号发布和推送固件
   - 监控固件更新状态

2. **插件管理**：
   - 上传和管理插件
   - 支持插件的版本控制和分发
   - 管理插件依赖关系

3. **设备管理**：
   - 查看设备列表和状态
   - 管理设备信息
   - 远程控制设备

4. **消息管理**：
   - 查看和管理设备消息
   - 支持消息的发送、接收、已读、删除等状态管理
   - 自动清理过期消息

#### API使用

服务端提供RESTful API接口，支持以下功能：

- 设备注册和管理
- 消息发送和接收
- 固件版本查询和发布
- 插件管理和分发

API文档详见：`http://your-server-address/api.php?path=docs`（需启用API文档功能）

## 二次开发

### 设备端二次开发

#### 开发环境搭建

1. 安装PlatformIO IDE
2. 克隆项目代码
3. 在PlatformIO中打开项目
4. 安装所需的依赖库

#### 固件生成工具

项目提供了一个命令行固件生成工具，用于根据实际需求生成最简固件，支持自定义选择硬件型号和功能模块。

##### 工具功能

- **运行环境检测**：自动检查Python版本和依赖包
- **硬件型号选择**：支持多种墨水屏和传感器型号选择
- **功能模块定制**：可启用或禁用相应功能模块
- **自动配置更新**：自动更新main.cpp中的条件编译宏
- **最简代码生成**：生成适合所选配置的最简代码

##### 工具位置

```
d:\InkClock\tool\generate_firmware.py
```

##### 使用方法

**Windows用户**：
```
cd d:\InkClock\tool
generate_firmware.bat
```

**Linux/Mac用户**：
```
cd /path/to/InkClock/tool
python3 generate_firmware.py
```

#### 模块扩展

1. **添加新插件**：
   - 实现插件类，继承自`Plugin`基类
   - 在`plugin_manager.h`中定义插件类型
   - 在`plugin_manager.cpp`中注册插件

2. **添加新传感器驱动**：
   - 实现传感器驱动类，继承自`ISensorDriver`接口
   - 在`driver_registry.h`中注册驱动
   - 配置传感器默认参数

3. **添加新显示驱动**：
   - 实现显示驱动类，继承自`IDisplayDriver`接口
   - 在`display_manager.cpp`中使用新的显示驱动

### 服务端二次开发

#### 开发环境搭建

1. **安装开发环境**：
   - 安装PHP开发环境（如XAMPP、WAMP、Docker等）
   - 安装MySQL数据库
   - 安装代码编辑器（如VS Code、PhpStorm等）

2. **项目结构**：
   ```
d:\InkClock\webserver/
├── api.php              # API入口文件
├── config.php           # 配置文件
├── models/              # 数据模型目录
│   ├── Device.php       # 设备模型
│   ├── Message.php      # 消息模型
│   └── FirmwareVersion.php  # 固件版本模型
├── plugin/              # 插件目录
└── uploads/             # 文件上传目录
   ```

#### API扩展

1. **添加新API接口**：
   - 在`api.php`中添加新的路由处理函数
   - 实现相应的业务逻辑
   - 遵循RESTful API设计规范

2. **示例**：
   ```php
   // 在api.php的switch语句中添加新的路由
   case 'custom':
       handleCustomApi($method, $parts);
       break;
   
   // 实现新的API处理函数
   function handleCustomApi($method, $parts) {
       // 业务逻辑实现
       sendJsonResponse(array('status' => 'ok', 'message' => 'Custom API response'));
   }
   ```

#### 插件开发

1. **插件结构**：
   ```
   plugin/custom_plugin/
   ├── index.php         # 插件主文件
   └── plugin.json       # 插件配置文件
   ```

2. **插件配置**：
   ```json
   {
       "name": "CustomPlugin",
       "version": "1.0.0",
       "description": "自定义插件",
       "author": "开发者",
       "dependencies": []
   }
   ```

3. **插件开发流程**：
   - 创建插件目录和文件
   - 实现插件功能
   - 配置插件信息
   - 测试插件功能
   - 发布插件

#### 固件管理服务扩展

1. **添加新的固件验证机制**：
   - 在`FirmwareVersion.php`中添加新的验证方法
   - 实现自定义的固件验证逻辑
   - 在固件上传和安装过程中调用新的验证方法

2. **扩展固件推送策略**：
   - 实现基于设备分组的推送策略
   - 添加按版本号范围推送的功能
   - 支持固件推送的定时任务

3. **增强更新状态监控**：
   - 添加更详细的更新状态信息
   - 实现更新失败的自动重试机制
   - 支持更新日志的记录和查询

### 服务端与设备端通信协议

1. **通信方式**：
   - 基于HTTP/HTTPS的RESTful API
   - 支持JSON格式的数据传输
   - 设备定期轮询或服务器主动推送

2. **消息格式**：
   ```json
   {
       "device_id": "device-123",
       "message_type": "text",
       "content": "Hello, InkClock!",
       "timestamp": 1234567890,
       "status": "sent"
   }
   ```

3. **固件更新协议**：
   - 设备请求固件信息
   - 服务器返回固件版本和下载地址
   - 设备下载固件并验证
   - 设备安装固件并报告状态
   - 服务器更新固件状态

### 开发规范

1. **代码风格**：
   - 设备端：遵循C++11及以上标准，采用大驼峰命名法
   - 服务端：遵循PHP PSR-12规范，采用小驼峰命名法

2. **文档规范**：
   - 每个模块和函数都应有详细的注释
   - 保持文档与代码的一致性
   - 定期更新API文档

3. **测试规范**：
   - 实现单元测试和集成测试
   - 测试覆盖主要功能和边界情况
   - 定期进行回归测试

4. **版本管理**：
   - 使用语义化版本号（MAJOR.MINOR.PATCH）
   - 保持设备端和服务端版本的兼容性
   - 详细记录版本变更内容

## 架构设计文档

### 事件总线

事件总线是系统的核心通信机制，支持85+事件类型，包括：

- **系统事件**：系统启动、错误、电源状态变化等
- **驱动事件**：驱动注册、注销、设备发现等
- **传感器事件**：传感器数据更新、配置变化等
- **显示事件**：显示更新、页面切换等
- **时间事件**：时间更新、日期变化等
- **天气事件**：天气数据更新等
- **农历事件**：农历数据更新等
- **插件事件**：插件加载、卸载、配置变化等

### 驱动注册中心

驱动注册中心管理所有传感器和显示驱动，支持：

- 动态注册和注销驱动
- 自动检测和设备发现
- 驱动状态管理
- 多驱动支持

### 插件系统

插件系统支持动态加载和卸载插件，包括：

- 插件生命周期管理
- 插件配置管理
- 插件事件发布
- 在线插件获取

## 配置说明

主要配置文件为`src/coresystem/config.h`，包含以下主要配置项：

| 配置项 | 说明 | 默认值 |
|--------|------|--------|
| DISPLAY_TYPE | 显示类型 | EINK_75_INCH |
| DISPLAY_UPDATE_INTERVAL | 显示更新间隔（毫秒） | 60000 |
| AUTO_DETECT_LOCATION | 是否自动检测地理位置 | true |
| NTP_SERVER | NTP服务器 | "ntp.aliyun.com" |
| TIME_ZONE_OFFSET | 时区偏移（小时） | 8 |
| WEATHER_UPDATE_INTERVAL | 天气更新间隔（毫秒） | 3600000 |
| SENSOR_UPDATE_INTERVAL | 传感器更新间隔（毫秒） | 60000 |
| LOW_POWER_MODE_ENABLED | 是否启用低功耗模式 | true |

## 兼容元器件列表

### 主控芯片
- **ESP32系列**：ESP32-S3、ESP32-C3、ESP32-C6、ESP32-S2、ESP32-WROOM-32
- **ESP8266系列**：ESP8266-12F、ESP8266-07、ESP8266-WROOM-02
- **NRF52系列**：NRF52832、NRF52840
- **STM32系列**：STM32L4、STM32G4、STM32F4
- **RP2040系列**：Raspberry Pi Pico W

### 显示屏幕
- 标准墨水屏：1.54/2.13/2.66/2.7/2.9/3.12/4.2/4.37/5.4/5.83/6.0/7.5/7.8/10.3/12.48英寸
- 电子价签：1.54/2.13/2.66/2.9/3.12英寸双色电子价签
- 二手阅读器屏幕：6.0/7.8/10.3英寸单色/彩色阅读器屏幕

### 传感器
- **温湿度传感器**：DHT11、DHT12、DHT22、AM2302、SHT20、SHT21、SHT30、SHT40、HDC1080、HTU21D、SI7021、BME280、BME680
- **人体感应传感器**：PIR（通用）、HC-SR501、HC-SR505、RE200B、LD2410
- **光照传感器**：BH1750、TSL2561、GY30、SI1145
- **气体传感器**：MQ2、MQ5、MQ7、MQ8、MQ135、TGS2600、SGP30
- **火焰传感器**：IR火焰传感器、UV火焰传感器
- **气压传感器**：BMP280、BMP388、LPS25HB

### 电源模块
- **软包聚合物电池（3.7V）**：仅支持软包聚合物电池，保持产品轻薄
- **Type-C充电模块**：USB-Type-C接口，支持10W-20W充电功率，带充电保护
- **TP4056+Type-C充电模块**：性价比高，支持USB-Type-C接口
- **AXP192+Type-C电源管理模块**：功能强大，支持电量监测和充电管理

**注意：本设备仅支持USB-Type-C充电接口，不支持DC直插供电**

## 许可证

本项目采用MIT许可证，详见LICENSE文件。

## 贡献

欢迎提交Issue和Pull Request，共同完善项目。

## 作者信息

- 开发者：iswhat
- GitHub：https://github.com/iswhat/InkClock

## 版本历史

### v1.4 (2025-12-30)
- 固件生成工具改进：增加全量固件和自定义固件选项，优化功能排序
- 耗电管理策略优化：动态CPU频率调整、基于人体感应和光感应的低功耗策略
- 首次启动的网络配置功能：支持WiFi和蓝牙双途径配置
- 固件恢复出厂功能：支持软恢复（通过API）和硬件硬恢复（长按按键5秒）
- 固件写入前硬件支持校验：确保固件与硬件匹配，避免硬件损坏
- 代码修复和优化：修复传感器管理器和其他模块的逻辑问题
- 优化电源管理：改进低功耗模式下的传感器采样频率调整

### v1.4.0 (2025-12-31)
- **固件管理系统优化**：
  - 固件完整性验证：SHA-256哈希计算和验证
  - 固件签名验证机制：防止恶意固件
  - 双分区更新和回滚机制：避免设备变砖
  - 更新过程中的看门狗保护：防止更新失败导致死机
  - 关键配置备份和恢复机制：确保固件更新不会丢失重要配置
  - 电源稳定性检查：确保在安全电压下进行更新
  - 内存管理优化和内存不足检查：防止内存溢出
  - 增强的更新状态报告和错误处理：详细的错误代码和状态回调
  - 更新授权机制：只有授权设备才能进行远程更新
  - OTA更新重试机制：提高更新成功率
  
- **增强蓝牙配网和热点方式配置WiFi网络**：
  - 优化初始状态蓝牙配网过程，增强易用性、稳定性和容错性
  - 实现AP模式自动切换，当WiFi连接失败时自动进入AP模式
  - 添加WiFi配置保存和加载功能，实现一键连接
  - 增强蓝牙配网后的WiFi连接逻辑，确保配置后能正确连接
  - 优化AP模式的SSID命名，包含设备MAC地址后4位，便于区分不同设备
  - 为AP模式添加固定密码，方便用户连接
  - 实现AP模式下的Web配置页面提示
  - 增强蓝牙配网的状态通知，实时告知配置结果
  
- **远程控制和数据同步功能增强**：
  - 优化远程控制API，增强错误处理和稳定性
  - 扩展数据同步API，提供更全面的数据
  - 为刷新显示API添加请求频率限制，防止系统过载
  - 增加对POST请求JSON参数的支持，提高API的灵活性和兼容性
  - 增强参数验证，防止恶意请求
  
- **跨平台兼容性优化**：
  - 统一时间和延迟API：将所有`millis()`调用替换为`platformGetMillis()`，将所有`delay()`调用替换为`platformDelay()`
  - 统一系统重置API：将`ESP.restart()`替换为`platformReset()`
  - 为ESP32特定功能添加条件编译，提高代码跨平台兼容性
  
- **低功耗优化增强**：
  - 统一电源管理API调用
  - 使用平台无关的CPU频率控制
  - 为平台特定低功耗功能添加条件编译
  - 优化电池管理和低功耗策略

### v1.3 (2025-12-29)
- 实现三层架构设计：底层操作系统、驱动程序层、应用层
- 完善事件总线，支持85+事件类型
- 实现驱动注册中心，支持动态驱动管理
- 提取底层核心功能，形成独立的"微型操作系统"
- 重构应用层，通过事件总线与底层通信
- 实现插件系统，支持动态加载和卸载插件

### v1.2 (2025-12-29)
- 完善TF卡功能，支持存储音频、视频等数据
- 添加微型麦克风支持，实现本地音频留言功能
- 实现音频录制和播放功能
- 实现照片拍摄功能
- 完善Web界面，添加字体管理和TF卡管理功能
- 优化SPIFFS初始化，确保只初始化一次
- 添加字体文件格式验证
- 优化错误处理和性能

### v1.1 (2025-12-26)
- 新增地理位置自动识别功能
- 优化API管理模块
- 修复部分bug

### v1.0 (2025-12-01)
- 初始版本发布
- 支持基本的时间、天气、农历显示
- 支持Web配置和插件扩展
