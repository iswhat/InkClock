# 家用网络智能墨水屏万年历 - DIY说明

## 一、项目概述

本项目是一款基于ESP32的智能墨水屏万年历，具有低功耗、高清晰度、可远程配置等特点。通过本说明，您可以了解如何DIY制作这款设备。

## 二、所需材料

| 材料名称 | 数量 | 说明 |
|----------|------|------|
| ESP32-S3开发板 | 1块 | 主控芯片 |
| 墨水屏 | 1块 | 可选尺寸：1.54/2.13/2.66/2.7/2.9/3.12/4.2/4.37/5.4/5.83/6.0/7.5英寸 |
| 温湿度传感器 | 1个 | DHT22或SHT30（可选） |
| 软包聚合物电池 | 1个 | 3.7V，容量根据需求选择（推荐2000mAh-6000mAh） |
| Type-C充电模块 | 1个 | USB-Type-C接口，支持10W-20W充电功率，带充电保护 |
| AXP192+Type-C电源管理模块 | 1个 | 支持电量监测和充电管理 |
| 按键 | 4个 | 轻触按键 |
| 电阻 | 4个 | 10KΩ，用于按键上拉 |
| 杜邦线 | 若干 | 用于连接各个模块 |
| 外壳 | 1个 | 可3D打印或购买成品 |
| 螺丝 | 若干 | 用于固定外壳 |

## 三、硬件连接

### 1. 墨水屏连接

| 墨水屏引脚 | ESP32-S3引脚 |
|------------|--------------|
| VCC | 3.3V |
| GND | GND |
| SCK | GPIO18 |
| MOSI | GPIO23 |
| MISO | GPIO19 |
| CS | GPIO5 |
| DC | GPIO26 |
| RST | GPIO27 |
| BUSY | GPIO32 |

### 2. 温湿度传感器连接

**DHT22传感器：**
| DHT22引脚 | ESP32-S3引脚 |
|-----------|--------------|
| VCC | 3.3V |
| GND | GND |
| DATA | GPIO4 |

**SHT30传感器：**
| SHT30引脚 | ESP32-S3引脚 |
|-----------|--------------|
| VCC | 3.3V |
| GND | GND |
| SCL | GPIO22 |
| SDA | GPIO21 |

### 3. 按键连接

| 按键引脚 | ESP32-S3引脚 |
|----------|--------------|
| 按键1 | GPIO0 |
| 按键2 | GPIO1 |
| 按键3 | GPIO2 |
| 按键4 | GPIO3 |

每个按键需要串联一个10KΩ的上拉电阻。

### 4. 电源模块连接

#### 4.1 Type-C充电模块连接

| Type-C充电模块引脚 | ESP32-S3引脚 | 说明 |
|--------------------|--------------|------|
| VCC | USB-Type-C输入 | 连接USB-Type-C充电器 |
| GND | GND | 接地 |
| B+ | 软包聚合物电池正极 | 连接电池正极 |
| B- | 软包聚合物电池负极 | 连接电池负极 |
| OUT+ | VIN | 连接ESP32-S3的VIN引脚 |
| OUT- | GND | 连接ESP32-S3的GND引脚 |

#### 4.2 AXP192+Type-C电源管理模块连接

| AXP192引脚 | ESP32-S3引脚 | 说明 |
|------------|--------------|------|
| VIN | USB-Type-C输入 | 连接USB-Type-C充电器 |
| GND | GND | 接地 |
| VOUT2 | 3.3V | 连接ESP32-S3的3.3V引脚 |
| SCL | GPIO22 | I2C时钟引脚 |
| SDA | GPIO21 | I2C数据引脚 |
| EXTEN | EN | 复位引脚 |

**注意：本设备仅支持USB-Type-C充电接口，不支持DC直插供电**

## 四、软件烧录

### 1. 开发环境搭建

1. 下载并安装Visual Studio Code
2. 在VS Code中安装PlatformIO插件
3. 克隆项目代码：`git clone https://github.com/iswhat/InkClock.git`

### 2. 配置修改

打开`code/src/config.h`文件，修改以下配置项：

```cpp
// WiFi配置
#define WIFI_SSID "your_wifi_ssid" // WiFi名称
#define WIFI_PASSWORD "your_wifi_password" // WiFi密码

// 地理位置配置
#define AUTO_DETECT_LOCATION true // 是否自动检测地理位置
#define GEO_CITY_ID "your_city_id" // 城市ID（当自动检测失败时使用）
#define GEO_CITY_NAME "your_city_name" // 城市名称

// 天气API配置
#define WEATHER_API_KEY "your_weather_api_key" // 天气API密钥
#define WEATHER_API_KEY_BACKUP "your_weatherapi_key" // 备用天气API密钥
```

### 3. 编译和上传

1. 在PlatformIO中打开项目
2. 选择对应的开发板型号（ESP32-S3 Dev Module）
3. 点击"Upload"按钮，将固件上传到开发板

## 五、首次配置

1. 设备启动后，会创建一个名为"InkClock-XXXX"的WiFi热点
2. 用手机或电脑连接该热点
3. 在浏览器中访问192.168.4.1
4. 配置WiFi信息和基本设置
5. 保存配置后，设备会自动连接到指定的WiFi网络

## 六、功能测试

1. **时间显示**：检查时间是否准确，是否自动同步
2. **天气显示**：检查当前天气和天气预报是否正确
3. **农历显示**：检查农历日期和节气是否正确
4. **传感器数据**：检查温湿度数据是否正常
5. **按键功能**：测试按键是否能够正常响应
6. **Web配置**：通过设备IP地址访问Web页面，检查配置功能是否正常

## 七、外壳制作

### 1. 3D打印外壳

1. 下载3D模型文件（位于`hardware/3d_models`目录下）
2. 使用3D打印机打印外壳
3. 打磨并组装外壳

### 2. 购买成品外壳

可以在淘宝、京东等平台搜索"ESP32墨水屏外壳"，选择合适的尺寸和款式。

## 八、注意事项

1. **电源安全**：使用锂电池时，注意防止过充和过放
2. **静电防护**：在组装过程中，注意静电防护，避免损坏电子元件
3. **引脚连接**：确保引脚连接正确，避免短路
4. **固件更新**：定期更新固件，获取新功能和修复bug
5. **网络安全**：设置强密码，定期更换密码
6. **功耗优化**：根据需求调整更新频率，降低功耗

## 九、常见问题解决

1. **设备无法启动**：
   - 检查电源连接是否正确
   - 检查锂电池是否有电
   - 检查引脚连接是否正确

2. **无法连接WiFi**：
   - 检查WiFi密码是否正确
   - 检查WiFi信号强度
   - 尝试重置设备

3. **显示异常**：
   - 检查墨水屏连接是否正确
   - 尝试重启设备
   - 检查固件版本是否兼容

4. **天气信息不更新**：
   - 检查天气API密钥是否正确
   - 确保设备能够访问互联网
   - 检查城市ID是否正确

## 十、资源获取

1. 项目代码：https://github.com/iswhat/InkClock
2. 3D模型：`hardware/3d_models`目录
3. 电路图：`elec/电路设计.md`
4. 固件更新：通过Web页面或OTA更新

## 十一、免责声明

本项目仅供学习和研究使用，请勿用于商业用途。在制作和使用过程中，因操作不当导致的任何损失，本项目作者不承担任何责任。
